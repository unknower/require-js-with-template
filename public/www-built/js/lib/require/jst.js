define(["module","text","underscore"],function(module,text,_){var settings=module.config()||{},loadResource=function(e,t,n,r){if(r.isBuild){text.load.call(text,e,t,n,r);return}t(["text!"+e],function(e){n(e?_.template(e,undefined,settings):function(){return""})})},write=function(pluginName,moduleName,write,config){text.write.call(text,pluginName,moduleName,{asModule:function(name,contents){contents=contents.substr(contents.indexOf("return")+7),contents=contents.substr(0,contents.lastIndexOf(";")-3);try{var template=_.template(eval(contents),undefined,settings);write.asModule(pluginName+"!"+moduleName,"define(function() { return "+template.source+" });")}catch(err){throw console.error("~~~~~"),console.error("FAILED TO COMPILE "+pluginName+"!"+moduleName),console.error("Error:		"+String(err)),console.error("\n"),err&&err.source&&(console.error("Error Source:\n"),console.error(err.source),console.error("\n\n")),console.error("Original Contents:\n"),console.error(contents),console.error("\n\n"),err}}},config)};return{load:loadResource,write:write}});